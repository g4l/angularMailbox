"use strict";MailApp.service("MyMailBox",function($http){this.getAllLetters=function(){return $http.get("https://test-api.javascript.ru/v1/avoznuk2/letters").then(function(response){return response.data})},this.getMailCategories=function(){return $http.get("https://test-api.javascript.ru/v1/avoznuk2/mailboxes").then(function(response){return response.data})},this.addLetter=function(mail){return $http.post("https://test-api.javascript.ru/v1/avoznuk2/letters",mail).then(function(response){return response.data})},this.getAll=function(){return $http.get("https://test-api.javascript.ru/v1/avoznuk2/users").then(function(response){return response.data})},this.addUser=function(user){return $http.post("https://test-api.javascript.ru/v1/avoznuk2/users",user).then(function(response){return response.data})},this.remove=function(user){return $http.delete("https://test-api.javascript.ru/v1/avoznuk2/users/"+user._id)}}).config(function($stateProvider){$stateProvider.state("category",{url:"category/:categoryId",template:'\n            <mailview category-id="categoryId" ng-repeat="letter in $ctrl.letters" letter="letter"></mailview>',controller:function($stateParams,$scope){$scope.categoryId=$stateParams.categoryId}})}).config(function($stateProvider){$stateProvider.state("mailview",{parent:"category",url:"/:letterId",template:'<mailview letter-id="letterId"/>',controller:function($stateParams,$scope){$scope.letterId=$stateParams.letterId}})}).config(function($stateProvider){$stateProvider.state("userCartItem",{url:"users",template:'<div ng-repeat = "user in $ctrl.users">\n              <user-cart-item user="user" remove="$ctrl.removeUser(user)"></user-сart-item>\n            </div>'})}).component("mailwrapper",{templateUrl:"templates/mailwrapper.html",controller:function(MyMailBox,$http){var _this=this;MyMailBox.getAllLetters().then(function(mails){_this.mails=mails}),MyMailBox.getMailCategories().then(function(mailcategories){_this.mailcategories=mailcategories}),this.getLetters=function(id){_this.letters=_this.mails.filter(function(mail){return mail.mailbox==id})},this.addMail=function(){var newMail={subject:_this.newSubject.trim(),body:_this.newBody.trim(),to:_this.newTo.trim(),mailbox:_this.mailcategories[1]._id};newMail.subject&&newMail.body&&newMail.to&&MyMailBox.addLetter(newMail).then(function(mail){_this.mails.push(mail),_this.newSubject=_this.newBody=_this.newBody=_this.newTo=""})},this.getAllUsers=function(){MyMailBox.getAll().then(function(users){return _this.users=users}),console.log(_this.users)},this.addUser=function(){var newUser={fullName:_this.newFullName.trim(),email:_this.newEmail.trim(),avatarUrl:_this.newAvatarUrl.trim(),birthdate:_this.newBirthdate.trim(),gender:_this.newGender.trim(),address:_this.newAddress.trim()};newUser.fullName&&newUser.email&&MyMailBox.addUser(newUser).then(function(user){_this.users.push(user),_this.newFullName=_this.newEmail=_this.newAvatarUrl=_this.newBirthdate=_this.newGender=_this.newAddress=""})},this.removeUser=function(user){MyMailBox.remove(user).then(function(){_this.users.splice(_this.users.indexOf(user),1)})}}}).component("mailcategories",{bindings:{mailcategory:"<",getletters:"&"},templateUrl:"templates/mailCategoryTemplate.html"}).component("mailview",{bindings:{letter:"<"},templateUrl:"templates/letterItem.html"}).component("contactBtn",{bindings:{getcontacts:"&"},templateUrl:"templates/contactBtn.html"}).component("userCartItem",{bindings:{user:"<",remove:"&"},templateUrl:"templates/userItemTemplate.html"});